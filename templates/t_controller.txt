<?php if (!defined('BASEPATH')) exit('No direct script access allowed');

# Generated by formgen.py - <fg_time>

class <fg_controller_name> extends CI_Controller {

        public function index()
        {
		if (!$this->tank_auth->is_logged_in()) {			// not logged in or not activated
			redirect('/auth/login/');
		} else {
			$this->load->model('<fg_model_name>');
			$data['<fg_table_name>s'] = $this-><fg_model_name>->get_all_<fg_table_name>s(); 

			$this->load->library('pagination');
                        $config['base_url'] = site_url('<fg_table_name>/index/');
                        $config['total_rows'] = count($data['<fg_table_name>s']);
                        $config['per_page'] = 1;
                        $this->pagination->initialize($config);

                	$this->load->view('header',$data);
                	$this->load->view('list_<fg_table_name>',$data);
                	$this->load->view('footer');
		}
        }

	function edit()
	{
		if (!$this->tank_auth->is_logged_in()) {			// not logged in or not activated
			redirect('/auth/login/');

		} else {
			$record_id = $this->uri->segment(3);
			$record_id = preg_replace('/[^a-zA-Z0-9-_]/','',$record_id);

			$this->load->model('<fg_model_name>');
			$this->load->helper('htmlpurifier');
		
			$userid = $this->tank_auth->get_user_id();

			<fg_form_validation_rules>
			$data['errors'] = array();

			if ($this->form_validation->run()) {			// validation ok
				if ($this-><fg_model_name>->change_<fg_table_name>(
						$record_id,
						<fg_form_validation_values>
					)) {	// success
					$this->session->set_flashdata('message','<fg_controller_name> successfully updated.' );
					$this->session->set_flashdata('message_type','success');
					redirect('<fg_table_name>');
				} else {														// fail
					$errors = $this->tank_auth->get_error_message();
					foreach ($errors as $k => $v)	$data['errors'][$k] = $this->lang->line($v);
				}
			}

			$data['a'] = $this-><fg_model_name>->get_<fg_table_name>($record_id); 
			if( $data['a'] ) {
				if ( $userid != ADMIN_USER_ID )  {
					$this->session->set_flashdata('message','Error: Invalid <fg_table_name> id.' );
					$this->session->set_flashdata('message_type','error' );
					redirect('');
				}
			} 

                	$this->load->view('header',$data);
                	$this->load->view('edit_<fg_table_name>',$data);
                	$this->load->view('footer');
		}
	}


	function create()
	{
		if (!$this->tank_auth->is_logged_in()) {								// not logged in or not activated
			redirect('/auth/login/');

		} else {
			$this->load->model('<fg_model_name>');
			$this->load->helper('htmlpurifier');

			<fg_form_validation_rules>
			$data['errors'] = array();

			if ($this->form_validation->run()) {								// validation ok
				if ($record_id = $this-><fg_model_name>->new_<fg_table_name>(
						<fg_form_validation_values>
					)) {	// success
					$this->session->set_flashdata('message','<fg_controller_name> information saved. ' );
					$this->session->set_flashdata('message_type','Success' );
					redirect('<fg_table_name>');
				} else {														// fail
					$errors = $this->tank_auth->get_error_message();
					foreach ($errors as $k => $v)	$data['errors'][$k] = $this->lang->line($v);
				}
			}

                	$this->load->view('header',$data);
                	$this->load->view('edit_<fg_table_name>',$data);
                	$this->load->view('footer');
		}
	}

	function remove() 
	{
		if (!$this->tank_auth->is_logged_in()) {
			redirect('/auth/login/');
		} else {
			$record_id = $this->uri->segment(3);
			$record_id = preg_replace('/[^a-zA-Z0-9-_]/','',$record_id);
			$this->load->model('<fg_model_name>');

			if( $result = $this-><fg_model_name>->remove_<fg_table_name>($record_id) ) {
				$this->session->set_flashdata('message','<fg_controller_name> deleted.' );
				$this->session->set_flashdata('message_type','success' );
			} else {
				$this->session->set_flashdata('message','<fg_controller_name> not deleted.' );
				$this->session->set_flashdata('message_type','error' );
			}
			redirect('<fg_table_name>');
		}
	}
}
